{
  "name": "tc",
  "permissions": "NONE",
  "restriction": "1",
  "_id": "VnIui",
  "actions": [
    {
      "code": "// Type Competition Command\nconst wm = this.getWrexMods();\nconst https = wm.require('https');\nconst path_fnt = `./fonts/Moms_Typewriter.ttf`;\nconst fs = require('fs');\nconst {\n    registerFont,\n    createCanvas,\n    loadImage,\n} = wm.require('canvas');\nconst randomWords = wm.require('random-words');\nconst {\n    stripIndents\n} = wm.require('common-tags');\nconst sleep = require('util').promisify(setTimeout)\n\nconst p = (server && server.tag) || Files.data.settings.tag;\nconst prefix = (msg.content.startsWith(String(me))) ? String(me) : p;\nconst text = msg.content.slice(prefix.length)\n    .trim()\n    .split(/ +/g);\ntext.shift();\n\n(async () => {\n    const randWord = randomWords(1).toString();\n\n    // Check if font file exists\n    if (!fs.existsSync(path_fnt)) {\n        const file = fs.createWriteStream(path_fnt);\n        https.get(\"https://raw.githubusercontent.com/TheMonDon/storage/master/Moms_Typewriter.ttf\", function (response) {\n            response.pipe(file);\n        });\n        console.log('Downloaded file to: ' + path_fnt);\n    }\n\n    registerFont(path_fnt, {\n        family: 'Moms Typewriter'\n    });\n\n    const canvas = createCanvas(290, 80);\n    const ctx = canvas.getContext('2d');\n    ctx.font = '18px \"Moms Typewriter\"';\n\n    if (me.permissions.has('MANAGE_MESSAGES')) msg.delete();\n\n    const em = new DiscordJS.MessageEmbed()\n        .setTitle('Typer Competition')\n        .setColor('#41f4eb')\n        .setDescription(stripIndents `\n            Who is the fastest? I will send a word, the person who types it the quickest wins!\n            To start, 2 or more people must react with ðŸ`);\n    const embed1 = await msg.channel.send(em);\n    await embed1.react('ðŸ');\n\n    const filter = (reaction, user) => {\n        return reaction.emoji.name === 'ðŸ' && !user.bot;\n    };\n    embed1.awaitReactions(filter, {\n            max: 2,\n            time: 60000,\n            errors: ['time']\n        })\n        .then((collected) => {\n            loadImage('https://i.lensdump.com/i/Wc8DKQ.jpg')\n                .then((image) => {\n\n                    ctx.drawImage(image, 0, 0, 290, 80);\n\n                    ctx.fillText(randWord, 90, 45);\n\n                    const attachment = new DiscordJS.MessageAttachment(canvas.toBuffer(), 'type-race.png');\n\n                    let getReady;\n                    let theImage;\n                    (async () => {\n                        getReady = await msg.channel.send(`Are you ready? \\n3`);\n                        await sleep(1000)\n                        getReady.edit(`Are you ready? \\n2`);\n                        await sleep(1000)\n                        getReady.edit(`Are you ready? \\n1`);\n                        await sleep(1000)\n                        getReady.edit('Go!');\n                        theImage = await msg.channel.send(attachment);\n                    })();\n\n                    const filter2 = (message) => {\n                        return message.content.toLowerCase() === randWord.toLowerCase();\n                    };\n                    msg.channel.awaitMessages(filter2, {\n                            max: 1,\n                            time: 30000,\n                            errors: ['time']\n                        })\n                        .then((collected2) => {\n                            getReady.delete();\n                            const t2 = theImage.createdAt;\n                            const t1 = collected2.first()\n                                .createdAt;\n                            const winner = collected2.first()\n                                .author;\n                            const time = (t1 - t2) / 1000;\n\n                            const em1 = new DiscordJS.MessageEmbed()\n                                .setTitle('Winner!')\n                                .setColor('#41f4eb')\n                                .setDescription(stripIndents `\n                            ${winner} won! :tada:\n                            Time: ${time}s`);\n                            msg.channel.send(em1);\n                        })\n                        .catch(err => {\n                            getReady.delete();\n                            msg.channel.send(`No one guessed the correct word in time.`);\n                        });\n\n                });\n        })\n        .catch(err => {\n            msg.channel.send(\"No one reacted in time\");\n        });\n})();",
      "behavior": "1",
      "interpretation": "1",
      "storage": "0",
      "varName": "",
      "VTypeSelect": "0",
      "CVTypeValue": "",
      "name": "Run Script"
    }
  ],
  "_aliases": [
    "typer-competition",
    "type-race",
    "type-racer"
  ]
}
